image: gcc
  

stages:          # List of stages for jobs, and their order of execution
  #- build
  #- test
  - deploy
 
before_script:
  - apt-get update --yes
  - apt-get install --yes cmake
  - apt-get -y install hdf5-tools 
  - apt-get -y install h5utils 
  - apt-get -y install libhdf5-dev 
 
  
#build-job:       # This job runs in the build stage, which runs first.
  #stage: build
  #script:
    #- rm -Rf build  
    #- mkdir build
    #- cd build
    #- cmake ..
    #- make -j8
  #artifacts:
    #paths:
      #- build/

#test-job:   # This job runs in the test stage.
  #stage: test    # It only starts when the job in the build stage completes successfully.
  #script:
    #- cd build
    #- ctest --repeat until-pass:10 --rerun-failed --output-on-failure

deploy-job:      # This job runs in the deploy stage.
  stage: deploy  # It only runs when *both* jobs in the test stage complete successfully.
  environment: production
  script:
    - apt-get -y install docker.io
    - cd docker
    - docker login -u $DOCKER_USER -p DOCKER_ACCESS_TOKEN
    - docker build -t $DOCKER_USER/idsimf-cli .
    - docker push mrajkovic/idsimf-cli:latest
    - echo "Application successfully deployed."

